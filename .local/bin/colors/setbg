#!/bin/sh

# This script sets a background image or gif animation, using pywal to set a terminal colorscheme,or otherwise
# using Xresources with xwallpaper, tested on dwm.

#	Usage:
#		` setbg [ -w, --wal ] [ -i, --input "path/to/img" ] [ -m, --maximize ] `

bgloc=$XDG_CONFIG_HOME/wp.png

while getopts ":hi:wm" o; do
	case "${o}" in
		h) printf "Usage :\\nsetbg [ -w, --wal ] [ -i, --input ;path/to/img; ] [ -m, --maximize ] [ -h: Show this message ]\\n" && exit ;;
		i)
			[ -n $2 ] && cp "$2" $bgloc > /dev/null 2>&1 && notify-send -i "$bgloc" "Wallpaper changed."
			xrdb -load $HOME/.Xresources && vimwal -x ;;
		w)
			wal -i $bgloc && wal -c && vimwal -w ;;
		m)
			format="--maximize" ;;
		*)
			printf "Invalid option: -%s\\n" "$OPTARG" && exit ;;
	esac
done

# Use gifview for gifs, or else xwallpaper
	format=${format:---zoom}
	mime="$( file --dereference --brief --mime-type -- "$bgloc" )"
	killall -q xwinwrap 2>/dev/null ;
	[ "$mime" = "image/gif" ] &&
	gifbg "$bgloc" ||
	xwallpaper $format "$bgloc"
