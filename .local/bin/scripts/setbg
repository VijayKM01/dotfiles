#!/bin/sh

# This script sets a background image or gif animation, using pywal to set a terminal colorscheme,or otherwise
# using Xresources with xwallpaper, tested on dwm.

#	Usage:
#		` setbg [ -w, --wal ] [ -i, --input "path/to/img" ] [ -f, --format "xwallpaper_option" ] `

bgloc=$XDG_CONFIG_HOME/wall.png
scheme=false


TEMP=$(getopt -o 'wi:f:' --long 'wal,input:,format:' -- "$@" )

eval set -- "$TEMP"
unset TEMP


while true; do
	case "$1" in
		'-w'|'--wal')
			scheme=true
			shift
			continue
		;;
		'-i'|'--input')
			[ -n $2 ] && cp "$2" $bgloc > /dev/null 2>&1 && notify-send -i "$bgloc" "Wallpaper changed."
			if [ $scheme = true ]; then
				wal -i $bgloc && wal -c && vimwal -w
			else
				xrdb -load $HOME/.Xresources && vimwal -x
			fi
			shift 2
			continue
		;;
		'-f'|'--format')
			format="$2"
			shift 2
			continue
		;;
		'--')
			shift
			break
		;;
		*)
			echo 'Error!' >&2
			exit 1
		;;
	esac
done

pidof dwm >/dev/null && xdotool key super+F12

format=${format:---zoom}
# Use gifview for gifs, otherwise xwallpaper
	killall -q xwinwrap 2>/dev/null ;
	if [ "$(file --dereference --brief --mime-type -- $bgloc)" = "image/gif" ]; then
		gifbg "$bgloc"
	else
		xwallpaper $format "$bgloc"
	fi
